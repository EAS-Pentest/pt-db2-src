<server description="Sample Open Liberty server">
<!--
  <featureManager>
    <feature>restfulWS-3.1</feature>
    <feature>jsonb-3.0</feature>
    <feature>mpMetrics-5.1</feature>
    <feature>mpHealth-4.0</feature>
    <feature>mpConfig-3.1</feature>
  </featureManager>
 -->
  <featureManager>
      <feature>jakartaee-10.0</feature>	   
      <feature>adminCenter-1.0</feature>
      <feature>batchManagement-1.0</feature>
      <feature>openidConnectClient-1.0</feature>
      <feature>openidConnectServer-1.0</feature>
      <feature>scim-1.0</feature>
      <feature>socialLogin-1.0</feature>
      <feature>mpOpenAPI-3.1</feature>
    </featureManager>

  <keyStore
		id="defaultKeyStore"
		password="{aes}ANAw/zVd2DRhHU7bd82rfxwa0Ets+b7hR07Io27P5ZML"
		type="jks"
		location="${server.config.dir}/key.jks" />

    <basicRegistry id="basic" realm="PentestRealm">
        <user name="adminUser" password="notAPwd4Admin"/>
        <user name="readerUser" password="notAPwd4Reader"/>
        <user name="employeeUser" password="notAPwd4Employee"/>
        <user name="managerUser" password="notAPwd4Manager"/>
        <user name="batchAdminUser" password="notAPwd4BatchAdmin"/>
        <user name="batchGroupAdminUser" password="notAPwd4BatchGroupAdmin"/>
        <user name="batchSubmitterUser" password="notAPwd4BatchSubmitter"/>
        <user name="batchMonitorUser" password="notAPwd4BatchMonitor"/>
        <user name="batchGroupMonitorUser" password="notAPwd4BatchGroupMonitor"/>
    </basicRegistry>

    <administrator-role>
        <user>adminUser</user>
    </administrator-role>

   
      <openidConnectClient id="client01" clientId="client01" clientSecret="notAPwd4Client01" mapIdentityToRegistryUser="true" discoveryEndpointUrl="${OIDC_SERVER_DISCOVERY}/oidc/endpoint/OidcProvider/.well-known/openid-configuration" userInfoEndpointEnabled="true" authFilterRef="simpleServletFilter"/>

  <!-- needed by curl odic API -->   
    <authFilter id="simpleServletFilter">
        <requestUrl id="simpleServletUrl" matchType="contains" urlPattern="/SimpleServlet"/>
    </authFilter>

  <!-- 5/04/2021 added -->
  <oidcLogin id="client02" clientId="client02" clientSecret="notAPwd4Client02" displayName="client02" userInfoEndpointEnabled="true" mapToUserRegistry="true" authFilterRef="secureSimpleServletFilter" discoveryEndpoint="${OIDC_SERVER_DISCOVERY}/oidc/endpoint/OidcProvider/.well-known/openid-configuration" hostNameVerificationEnabled="false" signatureAlgorithm="HS256"/>

    <authFilter id="secureSimpleServletFilter">
        <requestUrl id="secureSimpleServletUrl" matchType="contains" urlPattern="/SecureSimpleServlet"/>
    </authFilter>
 
   <openidConnectProvider id="OidcProvider" oauthProviderRef="OAuthProvider" keyStoreRef="defaultKeyStore" jwkEnabled="true"/>
    <oauthProvider id="OAuthProvider" autoAuthorizeParam="autoauthz">
        <localStore>
            <client id="client01" name="client01" secret="notAPwd4Client01" displayname="client01" scope="openid profile email ">
                <redirect>${OIDC_CLIENT_REDIRECT}/oidcclient/redirect/client01</redirect>
            </client>
            <client id="client02" name="client02" secret="notAPwd4Client02" displayname="client02" scope="openid profile email ">
                <redirect>${OIDC_CLIENT_REDIRECT}/ibm/api/social-login/redirect/client02</redirect>
            </client>
        </localStore> 
        <autoAuthorizeClient>client01</autoAuthorizeClient>
	<autoAuthorizeClient>client02</autoAuthorizeClient>
    </oauthProvider>
    <oauth-roles>
       <authenticated>
           <user name="adminUser"/>
           <special-subject type="ALL_AUTHENTICATED_USERS"/>
       </authenticated>
    </oauth-roles>
  
  <applicationManager autoExpand="true" />

  <mpMetrics authentication="false" />

  <variable name="default.http.port" defaultValue="9080"/>
  <variable name="default.https.port" defaultValue="9443"/>
  <variable name="app.context.root" defaultValue="/"/>

  <httpEndpoint host="*" httpPort="${default.http.port}" httpsPort="${default.https.port}" id="defaultHttpEndpoint"/>

  <webApplication location="io.openliberty.sample.getting.started.war" contextRoot="${app.context.root}"/>
</server>
